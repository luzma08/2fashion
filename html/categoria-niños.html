<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categoria niños</title>
    <link rel="stylesheet" href="../css/categorias.css">
    <link rel="shortcut icon" href="../img/icono-2-fashion.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <header class="header">
        <div class="logo">
            <a href="./landing.page.html"><img src="../img/logo.svg" alt="Logo"></a>
        </div>
    
        <div class="additional-logos">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="search" id="buscador" placeholder="Buscar ropa...">
            
            <i class="fa-solid fa-circle-info"></i>
        </div>
        
        <input type="checkbox" id="toggle">
        <label for="toggle"></label>
        
          
        <nav class="navegacion">
            <ul>
                <li><a href="./landing.page.html">Inicio</a></li>
                <li><a href="./sobrenostros.html">Sobre nosotras</a></li>
                <li>
                    <a href="#">Categorías</a>
                    <ul>
                        <li><a href="./categorias.html">Mujeres</a></li>
                        <li><a href="./categoria-hombre.html">Hombres</a></li>
                        <li><a href="./categoria-niños.html">Niños</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    
    
        <div class="iconos">
            <a href="./favoritos.html" class="icono-con-contador">
              <span class="contador" id="contador-fav">0</span>
              <i class="fa-solid fa-heart"></i>
            </a> 
            <a onclick="llevaracarrito()" class="icono-con-contador">
              <span class="contador" id="contador-carrito">0</span>
              <i class="fa-solid fa-cart-shopping"></i>
            </a>
            <a href="./infousuario.html"><i class="fa-solid fa-user"></i></a>
          </div>
    </header>
    
        


    

    <div class="ropa">
        <a href="javascript:void(0);" style="color: purple;" class="filtros" onclick="eliminarFiltros()">Eliminar filtros</a>

   
        <h3 class="titulo-ropa">Palabras clave</h3>
        <button class="primavera">Juvenil</button>  <button class="moderno">Estampado</button>  
        <form id="lista-ropa">
            <label  id="escoger-ropa"> <input  type="checkbox"  class="miCheckbox"name="ropa" id="ropa1">Blusas</label>
            <br>
            <label id="escoger-ropa"> <input type="checkbox" class="miCheckbox" name="ropa" id="ropa2">Faldas</label>
            <br>
            <label id="escoger-ropa"> <input type="checkbox" class="miCheckbox" name="ropa" id="ropa3">Sueteres</label>
            <br>
            <label id="escoger-ropa"> <input type="checkbox" class="miCheckbox" name="ropa" id="ropa4">Jeans</label>
            <br>
            <label id="escoger-ropa"> <input type="checkbox" class="miCheckbox" name="ropa" id="ropa5">Pantalonetas</label>

        </form>
        <h4 class="titulo-ropa">Color</h4>
        <form id="colores">
            <label id="escoger-color"> <input type="checkbox" class="miCheckbox" name="color" id="color1">Negro</label>
            <br>
            <label id="escoger-color"> <input type="checkbox"  class="miCheckbox"name="color" id="color2">Gris</label>
            <br>
            <label id="escoger-color"> <input type="checkbox" class="miCheckbox" name="color" id="color4">Azul</label>

        </form>
    </form>
    <h4 class="titulo-ropa">Tallas</h4>
    <form id="colores">
        <label id="escoger-tallas"> <input type="radio" class="miCheckbox" name="talla" id="talla1">6</label>
        <br>
        <label id="escoger-tallas"> <input type="radio" class="miCheckbox" name="talla" id="talla2">8</label>
        <br>
        <label id="escoger-tallas"> <input type="radio" class="miCheckbox" name="talla" id="talla3">9</label>
        <br>
        <label id="escoger-tallas"> <input type="radio"  class="miCheckbox"name="talla" id="talla4">10</label>

    </form>
    <div class="rango-precios">
        <!-- Barra de rango de precios -->
        <label for="precio">Rango de precios:</label><br>
        <input type="range" id="precio" name="precio" min="13000" max="31000" step="100" value="13000" oninput="actualizarValorPrecio()">
        
        <!-- Mostrar valores del rango -->
        <div class="valores-rango">
       
            <span id="valorActual">13.000</span>
        </div>
    </div>
    <button id="aplicar-filtros">Aplicar filtros</button>
    </div>
</div>

<!--Cuadros para poner las prendas de ropa -->
<section id="Mostradores">
    <!-- Los productos de niños se cargarán dinámicamente aquí mediante JavaScript -->
    <div class="cargando">Cargando productos...</div>
</section>

<<<<<<< HEAD
<footer class="footer">
    <div class="footer-content">
        <h1>2fashion</h1>
        <div class="conctact">
            <div class="title">Conctacto</div>
            <li class="lista">
                <ul class="elem">
                    2fashion
                </ul>
                <ul class="elem">
                    3155131227
                </ul>
                <ul class="elem">
                    devprogramm4.@gmail.com
                </ul>
            </li>
        </div>
        <div class="direction">
            <div class="title">Legal</div>
            <li class="lista">
                <ul class="elem">
                  <a href="../html/terminosycondiciones.html">Terminos y condiciones </a>  
    
                </ul>
                    <ul class="elem">
                    <a href="../html/poliricadeprivacidad.html">Política de pricivacidad y cookies</a> 
                </ul>
            </li>
        </div>
        <div class="services">
            <div class="title">Menu</div>
            <li class="lista">
                <ul class="elem">
                    <a href="./landing.page.html">Inicio</a> 
                </ul>
                <ul class="elem">
                    <a href="../html/sobrenostros.html">Sobre nosotros</a> 
                </ul>
                <ul class="elem">
                    <a href="../html/categorias.html">Categoria mujeres</a> 
                </ul>
                <ul class="elem">
                    <a href="../html/categoria-hombre.html">Categoria hombre</a> 
                </ul>
                <ul class="elem">
                    <a href="../html/categorias.html">Categoria niños</a> 
                </ul>
                <ul class="elem">
                  Personalizar ropa
                </ul>
            </li>
        </div>
        <div class="social">
            <div class="title">Conctacto</div>
            <div class="social-content">
                <a class="elem">
                    <i class="fa-brands fa-instagram"></i>
                </a>
                <a class="elem">
                    <i class="fa-brands fa-facebook"></i>
                </a>
                <a class="elem">
                    <i class="fa-brands fa-whatsapp"></i>
                </a>
            </div>
        </div>
    </div>
     </footer>

<div id="mensaje-carrito" style="font-family: Poppins, serif;  position: fixed; top: 20px; right: 20px; background-color: #53214F; color: white; padding: 10px 20px; border-radius: 10px; z-index: 9999;"></div>
=======
<div id="mensaje-carrito" style="font-family: Poppins, serif; display: none; position: fixed; top: 20px; right: 20px; background-color: #53214F; color: white; padding: 10px 20px; border-radius: 10px; z-index: 9999;"></div>
>>>>>>> e870d6c (Subo mis archivos actualizados)

<script >
 // Configuración de Supabase
const SUPABASE_URL = 'https://hxrcmbaxxfvlgubpdifu.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh4cmNtYmF4eGZ2bGd1YnBkaWZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI0OTgxNzQsImV4cCI6MjA1ODA3NDE3NH0.uPrLyN5PfPv8kx414tZetdQLkiQGXq9Lkg_kJZ1zvyc';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let todosLosProductos = [];
let productosFiltrados = [];
let productosMostrados = 8;
const incrementoProductos = 4;

const categoriaActual = 'niño'; // ESPECÍFICO para esta página

async function cargarProductos() {
    try {
        const productosContainer = document.getElementById('productos-container') || document.getElementById('Mostradores');
        productosContainer.innerHTML = '<p class="cargando">Cargando productos...</p>';
        const { data, error } = await supabase
            .from('productos')
            .select('*')
            .eq('categoria', categoriaActual)
            .eq('vendido', false)
            .order('created_at', { ascending: false });
        if (error) throw error;
        todosLosProductos = data || [];
        productosFiltrados = [...todosLosProductos];
        productosMostrados = 8;
        mostrarProductos();
    } catch (error) {
        const productosContainer = document.getElementById('productos-container') || document.getElementById('Mostradores');
        productosContainer.innerHTML = '<p class="error">Error al cargar los productos. Por favor, recarga la página.</p>';
    }
}

function mostrarProductos() {
    const productosContainer = document.getElementById('productos-container') || document.getElementById('Mostradores');
    productosContainer.innerHTML = '';
    if (!productosFiltrados || productosFiltrados.length === 0) {
        productosContainer.innerHTML = '<p class="no-productos">No hay productos disponibles con los filtros seleccionados.</p>';
        return;
    }
    const productosVisibles = productosFiltrados.slice(0, productosMostrados);
    const productosPorFila = 4;
    for (let i = 0; i < productosVisibles.length; i += productosPorFila) {
        const fila = document.createElement('div');
        fila.className = 'fila';
        for (let j = i; j < i + productosPorFila && j < productosVisibles.length; j++) {
            const producto = productosVisibles[j];
            const productoElement = crearProductoElement(producto);
            fila.appendChild(productoElement);
        }
        productosContainer.appendChild(fila);
    }
    const mostrarMasBtn = document.getElementById('mostrar-mas');
    if (mostrarMasBtn) {
        if (productosMostrados >= productosFiltrados.length) {
            mostrarMasBtn.style.display = 'none';
        } else {
            mostrarMasBtn.style.display = 'block';
        }
    }
    agregarEventListeners();
    actualizarContadores();
}

function crearProductoElement(producto) {
    const recuadro = document.createElement('div');
    recuadro.className = 'recuadro-ropa';
    recuadro.setAttribute('data-producto-id', producto.id);
    recuadro.innerHTML = `
        <div class="cuadroderopa">
            <a href="detalles_productos.html?id=${producto.id}"> 
                <div class="img-categorias"> 
                    <img src="${producto.imagen_url}" alt="${producto.nombre}">
                </div>
            </a>
        </div>
        <div class="texto-info">
            <h4>${producto.nombre}</h4>
            <p class="talla-compra">Talla: ${producto.talla}</p>
        </div>
        <a href="#" class="btn-carrito" data-id="${producto.id}">
            <i id="icono-compra" class="fa-solid fa-cart-shopping"></i>
        </a>
        <a href="#" class="btn-favorito" data-id="${producto.id}">
            <i id="icono-corazon" class="fa-solid fa-heart"></i>
        </a> 
        <div class="texto-precio"><h3>${formatearPrecio(producto.precio)}</h3></div>
    `;
    return recuadro;
}

function formatearPrecio(precio) {
    return '$' + Number(precio).toLocaleString('es-CO');
}

function agregarEventListeners() {
    document.querySelectorAll('.btn-carrito').forEach(boton => {
        boton.addEventListener('click', function(e) {
            e.preventDefault();
            const productoId = this.getAttribute('data-id');
            agregarAlCarrito(productoId); // SOLO agrega al carrito (NO marca vendido)
        });
    });
    document.querySelectorAll('.btn-favorito').forEach(boton => {
        boton.addEventListener('click', function(e) {
            e.preventDefault();
            const productoId = this.getAttribute('data-id');
            agregarAFavoritos(productoId);
        });
    });
}

function agregarAlCarrito(productoId) {
    const producto = todosLosProductos.find(p => p.id == productoId);
    if (!producto) return;
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    carrito.push({
        id: producto.id,
        nombre: producto.nombre,
        precio: producto.precio,
        imagen_url: producto.imagen_url,
        talla: producto.talla,
        cantidad: 1
    });
    localStorage.setItem('carrito', JSON.stringify(carrito));
    mostrarMensaje('carrito', `${producto.nombre} añadido al carrito`);
    actualizarContadores();
    // NO marques como vendido aquí
}

function agregarAFavoritos(productoId) {
    const producto = todosLosProductos.find(p => p.id == productoId);
    if (!producto) return;
    let favoritos = JSON.parse(localStorage.getItem('favoritos')) || [];
    if (!favoritos.some(item => item.id == productoId)) {
        favoritos.push({
            id: producto.id,
            nombre: producto.nombre,
            precio: producto.precio,
            imagen_url: producto.imagen_url,
            talla: producto.talla
        });
        mostrarMensaje('favoritos', `${producto.nombre} añadido a favoritos`);
    } else {
        mostrarMensaje('favoritos', `${producto.nombre} ya está en favoritos`);
    }
    localStorage.setItem('favoritos', JSON.stringify(favoritos));
    actualizarContadores();
}

function mostrarMensaje(tipo, mensaje, esError = false) {
    const elementoMensaje = document.getElementById(`mensaje-${tipo}`);
    if (!elementoMensaje) return;
    elementoMensaje.textContent = mensaje;
    elementoMensaje.style.display = 'block';
    elementoMensaje.style.backgroundColor = esError ? '#d32f2f' : '#53214F';
    setTimeout(() => {
        elementoMensaje.style.display = 'none';
    }, 2500);
}

function actualizarContadores() {
    const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    const favoritos = JSON.parse(localStorage.getItem('favoritos')) || [];
    document.getElementById('contador-carrito').textContent = carrito.length;
    document.getElementById('contador-fav').textContent = favoritos.length;
}

function aplicarFiltros(e) {
    if (e) e.preventDefault();
    let filtrados = [...todosLosProductos];
    const ropasSeleccionadas = Array.from(document.querySelectorAll('#lista-ropa input:checked')).map(cb => cb.parentElement.textContent.trim().toLowerCase());
    if (ropasSeleccionadas.length > 0) {
        filtrados = filtrados.filter(producto => {
            const nombreLimpio = (producto.nombre || "").trim().toLowerCase();
            return ropasSeleccionadas.some(tipo => nombreLimpio.includes(tipo));
        });
    }
    const coloresSeleccionados = Array.from(document.querySelectorAll('#colores input[name="color"]:checked')).map(cb => cb.parentElement.textContent.trim());
    if (coloresSeleccionados.length > 0) {
        filtrados = filtrados.filter(producto =>
            coloresSeleccionados.some(color =>
                (producto.descripcion || '').toLowerCase().includes(color.toLowerCase())
            )
        );
    }
    const tallaSeleccionada = document.querySelector('#tallas input[name="talla"]:checked')?.parentElement.textContent.trim();
    if (tallaSeleccionada) {
        filtrados = filtrados.filter(producto =>
            producto.talla === tallaSeleccionada
        );
    }
    const precioMaximo = parseInt(document.getElementById('precio').value, 10);
    filtrados = filtrados.filter(producto =>
        parseFloat(producto.precio) <= precioMaximo
    );
    productosFiltrados = filtrados;
    productosMostrados = 8;
    mostrarProductos();
}

function eliminarFiltros() {
    document.querySelectorAll('.miCheckbox').forEach(cb => { cb.checked = false; });
    document.getElementById('precio').value = 13000;
    actualizarValorPrecio();
    productosFiltrados = [...todosLosProductos];
    productosMostrados = 8;
    mostrarProductos();
}

function actualizarValorPrecio() {
    const valor = document.getElementById('precio').value;
    document.getElementById('valorActual').textContent = `${parseInt(valor).toLocaleString('es-CO')}`;
}

function cargarMasProductos() {
    productosMostrados += incrementoProductos;
    mostrarProductos();
}

function llevaracarrito() {
    window.location.href = "/html/carrito.html";
}

document.addEventListener('DOMContentLoaded', () => {
    cargarProductos();
    const mostrarMasBtn = document.getElementById('mostrar-mas');
    if (mostrarMasBtn) {
        mostrarMasBtn.addEventListener('click', function(e) {
            e.preventDefault();
            cargarMasProductos();
        });
    }
    const aplicarFiltrosBtn = document.getElementById('aplicar-filtros');
    if (aplicarFiltrosBtn) {
        aplicarFiltrosBtn.addEventListener('click', function(e) {
            e.preventDefault();
            aplicarFiltros();
        });
    }
    actualizarContadores();
    const precioInput = document.getElementById('precio');
    if (precioInput) {
        precioInput.addEventListener('input', actualizarValorPrecio);
    }
});
</script>

</body>
</html>